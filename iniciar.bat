echo Off
title :: Xiaomi Tools for Devices ::
mode 73,19
Color 1f
cd %~dp0


:MenuPrincipal
Cls
Echo.
Echo  зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                      Xiaomi Tools for Devices:                      Ё
Echo  Ё Versфo: 1.0                                                         Ё
Echo  Ё Autor : Francisco Eduardo  @srfranciscomont                         Ё
Echo  Ё Ajude realizando uma doa┤фo :) - https://goo.gl/ESm5aP              Ё
Echo  Ё                                                                     Ё
Echo  юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды 
Echo  здддбддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё ^> Ё                              Menu:                              Ё
Echo  цдддедддддддддддддддддддддддддддддбдбдддбддддддддддддддддддддддддддддд╢
Echo  Ё 1 Ё Instalar drivers (x86/x64)  Ё Ё 5 Ё Instalar TWRP               Ё
Echo  Ё 2 Ё Iniciar processo de flash   Ё Ё   Ё                             Ё
Echo  Ё 3 Ё Desbloqueio do bootloader   Ё Ё   Ё                             Ё
Echo  Ё 4 Ё Status do bootloader        Ё Ё   Ё                             Ё
Echo  цдддеддддддддддддддддддддддддддддд╢ Ё   Ё                             Ё
Echo  Ё 0 Ё Sair                        Ё Ё   Ё                             Ё
Echo  юдддаддддддддддддддддддддддддддддды юдддаддддддддддддддддддддддддддддды
Set "Menu="
Set /p "Menu=>"
If "%Menu%"=="1" (Goto Drivers)
If "%Menu%"=="2" (Goto Flash)
If "%Menu%"=="3" (Goto Unlock)
If "%Menu%"=="4" (Goto Bootloader)
If "%Menu%"=="5" (Goto Twrp)
If "%Menu%"=="0" (Goto Exit)
Goto MenuPrincipal

:Drivers
If Not "%SafeBoot_Option%"=="" (Goto)
Reg Add "HKLM" /F>nul 2>&1
If Not "%ErrorLevel%"=="0" (
Color 4f

cls
Echo. 
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                              Aten┤фo:                              Ё
Echo  Ё                                                                    Ё
Echo  Ё                 Execute o script como administrador.               Ё 
Echo  Ё                                                                    Ё
Echo  Ё                                                                    Ё
Echo  Ё          Pressione qualquer tecla para finalizar o script.         Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.
Pause>nul
cls
Exit
)

cd %~dp0

cls
Echo. 
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                              Aten┤фo:                              Ё
Echo  Ё                                                                    Ё
Echo  Ё       Encerre qualquer aplicativo aberto antes de continuar.       Ё 
Echo  Ё                                                                    Ё
Echo  Ё          Pressione qualquer tecla para iniciar o script.           Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.
Pause>nul
cls

cd %~dp0driver
pnputil.exe -a android_winusb.inf

Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё        Pressione qualquer tecla para voltar a tela inicial.        Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.
Pause>nul
Goto MenuPrincipal

:Flash
cd %~dp0

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё Selecione seu aparelho:                                            Ё
Echo  Ё (1) Redmi Note 2                                                   Ё
Echo  Ё (2) Mi 4C                                                          Ё
Echo  Ё                                                                    Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.
Set "Device="
Set /p "Device=>"
If "%Device%"=="1" (Goto RDN2)
If "%Device%"=="2" (Goto Mi4C)
Goto Flash

:RDN2
cd %~dp0
set rom="%~dp0rom"
set firmware="%~dp0firmware"
set logs="%~dp0logs"

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё                        Realizando download.                        Ё
Echo  Ё                                                                    Ё
Echo  Ё               O processo pode demorar algumas horas.               Ё
Echo  Ё                  Aproveite para tomar um suco :D.                  Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.

cd %~dp0util
wget.exe --no-check-certificate -O %rom%\RDN2.tgz http://bigota.d.miui.com/V8.0.1.0.LHMMIDG/hermes_global_images_V8.0.1.0.LHMMIDG_20160805.0000.29_5.0_global_05ec44b9a8.tgz  >%logs%\wget.txt 2>&1

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё                      Descompactando o firmware.                    Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.

7za.exe -aoa e %rom%\RDN2.tgz -o%firmware% >%logs%\7zip.txt 2>&1
7za.exe -aoa e %firmware%\RDN2.tar -o%firmware%\miui >%logs%\7zip.txt 2>&1

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё                Coloque o aparelho em modo "FASTBOOT"               Ё
Echo  Ё                                                                    Ё
Echo  Ё          (Desligue o aparelho e aperte Power + Vol Down)           Ё
Echo  Ё                                                                    Ё
Echo  Ё          Pressione qualquer tecla para iniciar o script.           Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.
Pause>nul

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё                          Iniciando Flash!                          Ё
Echo  Ё                                                                    Ё
Echo  Ё Logs na pasta: logs/fastboot.txt                                   Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.

cd %~dp0fastboot
fastboot flash system %firmware%\miui\system.img >%logs%\fastboot.txt 2>&1
fastboot flash cache %firmware%\miui\cache.img >%logs%\fastboot.txt 2>&1
fastboot flash userdata %firmware%\miui\userdata.img >%logs%\fastboot.txt 2>&1
fastboot flash recovery %firmware%\miui\recovery.img >%logs%\fastboot.txt 2>&1
fastboot flash boot %firmware%\miui\boot.img >%logs%\fastboot.txt 2>&1
fastboot flash secro %firmware%\miui\secro.img >%logs%\fastboot.txt 2>&1
fastboot flash lk %firmware%\miui\lk.bin >%logs%\fastboot.txt 2>&1
fastboot flash logo %firmware%\miui\logo.bin >%logs%\fastboot.txt 2>&1
fastboot reboot

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё                         Realizando limpeza.                        Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.

rd /s /q %firmware% >%logs%\limpeza.txt 2>&1

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё        Pressione qualquer tecla para voltar a tela inicial.        Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.
Pause>nul
Goto MenuPrincipal

:Mi4C
cd %~dp0
set rom="%~dp0rom"
set firmware="%~dp0firmware"
set logs="%~dp0logs"

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё                        Realizando download.                        Ё
Echo  Ё                                                                    Ё
Echo  Ё               O processo pode demorar algumas horas.               Ё
Echo  Ё                  Aproveite para tomar um suco :D.                  Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.

cd %~dp0util
wget.exe --no-check-certificate -O %rom%\Mi4C.tgz http://bigota.d.miui.com/6.1.7/libra_images_6.1.7_20151221.0000.11_5.1_cn_b09dac70a0.tgz >%logs%\wget.txt 2>&1

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё                      Descompactando o firmware.                    Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.

7za.exe -aoa e %rom%\Mi4C.tgz -o%firmware% >%logs%\7zip.txt 2>&1
7za.exe -aoa e %firmware%\Mi4C.tgz -o%firmware%\miui >%logs%\7zip.txt 2>&1

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё                Coloque o aparelho em modo "FASTBOOT"               Ё
Echo  Ё                                                                    Ё
Echo  Ё          (Desligue o aparelho e aperte Power + Vol Down)           Ё
Echo  Ё                                                                    Ё
Echo  Ё          Pressione qualquer tecla para iniciar o script.           Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.
Pause>nul

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё                          Iniciando Flash!                          Ё
Echo  Ё                                                                    Ё
Echo  Ё Logs na pasta: logs/fastboot.txt                                   Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.

cd %~dp0fastboot
fastboot flash pmic %firmware%\miui\pmic.mbn >%logs%\fastboot.txt 2>&1
fastboot flash pmicbak %firmware%\miui\pmic.mbn >%logs%\fastboot.txt 2>&1
fastboot flash hyp %firmware%\miui\hyp.mbn >%logs%\fastboot.txt 2>&1
fastboot flash hypbak %firmware%\miui\hyp.mbn >%logs%\fastboot.txt 2>&1
fastboot flash tz %firmware%\miui\tz.mbn >%logs%\fastboot.txt 2>&1
fastboot flash tzbak %firmware%\miui\tz.mbn >%logs%\fastboot.txt 2>&1
fastboot flash sbl1 %firmware%\miui\sbl1.mbn >%logs%\fastboot.txt 2>&1
fastboot flash sbl1bak %firmware%\miui\sbl1.mbn >%logs%\fastboot.txt 2>&1
fastboot flash sdi %firmware%\miui\sdi.mbn >%logs%\fastboot.txt 2>&1
fastboot flash rpm %firmware%\miui\rpm.mbn >%logs%\fastboot.txt 2>&1
fastboot flash rpmbak %firmware%\miui\rpm.mbn >%logs%\fastboot.txt 2>&1
fastboot flash aboot %firmware%\miui\emmc_appsboot.mbn >%logs%\fastboot.txt 2>&1
fastboot flash abootbak %firmware%\miui\emmc_appsboot.mbn >%logs%\fastboot.txt 2>&1
fastboot erase boot >%logs%\fastboot.txt 2>&1
fastboot erase sec >%logs%\fastboot.txt 2>&1
fastboot flash misc %firmware%\miui\misc.img >%logs%\fastboot.txt 2>&1
fastboot flash modem %firmware%\miui\NON-HLOS.bin >%logs%\fastboot.txt 2>&1
fastboot flash cache %firmware%\miui\cache.img >%logs%\fastboot.txt 2>&1
fastboot flash userdata %firmware%\miui\userdata.img >%logs%\fastboot.txt 2>&1
fastboot flash system %firmware%\miui\system.img >%logs%\fastboot.txt 2>&1
fastboot flash recovery %firmware%\miui\recovery.img >%logs%\fastboot.txt 2>&1
fastboot flash boot %firmware%\miui\boot.img >%logs%\fastboot.txt 2>&1
fastboot flash bluetooth %firmware%\miui\BTFM.bin >%logs%\fastboot.txt 2>&1
fastboot flash logo %firmware%\miui\logo.img >%logs%\fastboot.txt 2>&1
fastboot flash bk2 %firmware%\miui\bk2.img >%logs%\fastboot.txt 2>&1
fastboot flash cust %firmware%\miui\cust.img >%logs%\fastboot.txt 2>&1
fastboot reboot >%logs%\fastboot.txt 2>&1

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё                         Realizando limpeza.                        Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.

rd /s /q %firmware% >%logs%\limpeza.txt 2>&1

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё        Pressione qualquer tecla para voltar a tela inicial.        Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.
Pause>nul
Goto MenuPrincipal

:Unlock
cd %~dp0
cd %~dp0fastboot
set logs="%~dp0logs"

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                              Aten┤фo:                              Ё
Echo  Ё                                                                    Ё
Echo  Ё       Apenas para o aparelho Mi 4C. Em breve mais aparelhos.       Ё
Echo  Ё                                                                    Ё
Echo  Ё          Pressione qualquer tecla para iniciar o script.           Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.
Pause>nul

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё                Coloque o aparelho em modo "FASTBOOT"               Ё
Echo  Ё                                                                    Ё
Echo  Ё          (Desligue o aparelho e aperte Power + Vol Down)           Ё
Echo  Ё                                                                    Ё
Echo  Ё          Pressione qualquer tecla para iniciar o script.           Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.
Pause>nul

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё                       Realizando desbloqueio                       Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.
Pause>nul

fastboot oem unlock >%logs%\fastboot.txt 2>&1

Goto Bootloader

:Bootloader
cd %~dp0
set logs="%~dp0logs"

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                               Status:                              Ё
Echo  Ё                                                                    Ё
Echo  Ё  Device unlocked: false - Bloqueado                                Ё
Echo  Ё  Device unlocked: true - Destravado                                Ё
Echo  Ё                                                                    Ё
Echo  Ё        Pressione qualquer tecla para voltar a tela inicial.        Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.

cd %~dp0fastboot
fastboot oem device-info
Pause>nul
fastboot reboot

Goto MenuPrincipal

:TWRP 
cd %~dp0
set logs="%~dp0logs"
set recovery="%~dp0recovery"

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                              Aten┤фo:                              Ё
Echo  Ё                                                                    Ё
Echo  Ё       Apenas para o aparelho Mi 4C. Em breve mais aparelhos.       Ё
Echo  Ё                                                                    Ё
Echo  Ё          Pressione qualquer tecla para iniciar o script.           Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.
Pause>nul

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё                        Realizando download.                        Ё
Echo  Ё                                                                    Ё
Echo  Ё                 Isso demora apenas alguns minutos!                 Ё
Echo  Ё                  Aproveite para ir ao banheiro :D                  Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.

cd %~dp0util
wget.exe --no-check-certificate -O %recovery%\recovery.zip https://github.com/franciscomont/Xiaomi-Tools-for-Devices/blob/master/recovery/recovery.zip?raw=true  >%logs%\wget.txt 2>&1

Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё                      Descompactando o recovery.                    Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.

7za.exe e %recovery%\recovery.zip -o%recovery% >%logs%\7zip.txt 2>&1

cls
Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё                Coloque o aparelho em modo "FASTBOOT"               Ё
Echo  Ё                                                                    Ё
Echo  Ё          (Desligue o aparelho e aperte Power + Vol Down)           Ё
Echo  Ё                                                                    Ё
Echo  Ё          Pressione qualquer tecla para iniciar o script.           Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.
Pause>nul

cd %~dp0fastboot
fastboot flash recovery recovery.img >%logs%\fastboot.txt 2>&1

Echo.
Echo  здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Echo  Ё                                                                    Ё
Echo  Ё                         Realizando limpeza.                        Ё
Echo  Ё                                                                    Ё
Echo  юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Echo.

rd /s /q %recovery% >%logs%\limpeza.txt 2>&1

Goto Bootloader